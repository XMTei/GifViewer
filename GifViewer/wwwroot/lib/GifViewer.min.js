function GetUIStrings(){$("#ShowErrorMessage").hide();var n=getGetUIStringsParamJsonData(),t={async:!1,crossDomain:!0,url:uri+"/GetUIStrings",method:"POST",headers:{"content-type":"application/json","cache-control":"no-cache"},data:n,success:function(n,t,i){var f=i.getResponseHeader("content-type")||"",u,r;if(f.indexOf("json")>=0)if(n.type&&n.type.indexOf("Json")>=0&&n.data&&n.data.length>0){oUIStringDic=null;try{u=JSON.parse(n.data);u&&(oUIStringDic=u)}catch(e){ShowErrorMessage("Data Error!","Bad UI strings JSON Data:"+e)}}else r="Can not translate UI.",n.type&&(r+=",DataType:"+n.type,n.type.indexOf("Text")>=0&&(r+=",Message:"+n.data)),alert(r)},error:function(n,t){ShowErrorMessage("Server Error!",t)}};$.ajax(t)}function ShowNextData(){var n,t,i;$("#ShowErrorMessage").hide();n=$.guid++;resetImageFiFo.push(n);t=getGetNextDataParamJsonData(n);i={async:!0,crossDomain:!0,url:uri+"/GetNextData",method:"POST",headers:{"content-type":"application/json","cache-control":"no-cache"},data:t,success:function(n,t,i){var f,r;Imagedata.src="";var e=0,u=0,c=i.getResponseHeader("content-type")||"";c.indexOf("json")>=0&&(f=-1,n.callFiFoGUID>=0&&(f=resetImageFiFo.indexOf(n.callFiFoGUID)),n.type&&f>=0&&(resetImageFiFo.splice(0,f+1),resetImageFiFo.length<=0&&ShowHideOnProcessing(!1),n.type.indexOf("Json")>=0&&(r=JSON.parse(n.data),r&&(r.Type.indexOf("GifBase64")>=0?Imagedata.src="data:image/gif;base64,"+r.Data:r.Type.indexOf("PngBase64")>=0?Imagedata.src="data:image/png;base64,"+r.Data:r.Type.indexOf("TiffBase64")>=0&&(Imagedata.src="data: image/tiff;base64,"+r.Data),strCurrentFileName=r.FileName,e=r.Index,u=r.Total))));var s=$(Progressbar),h=0,o="";u>0?(o="("+strCurrentFileName+") "+e+"/"+u,h=e/u*100):oUIStringDic&&(o=oUIStringDic.Constant.NoGifFileOnServer);s.css("width",h+"%");s.html(o);setTimeout(function(){ShowNextData()},GetTimeInterval($(TimeInterval).val()))},error:function(n,t){ShowErrorMessage("Server Error!",t)}};$.ajax(i)}function UploadFiles(n){var i,r,t,u;for($("#ShowErrorMessage").hide(),i=n.currentTarget.files,r=new FormData,t=0;t<i.length;t++)r.append(i[t].name,i[t]);u={url:uri+"/Upload",method:"POST",headers:{"content-type":"multipart/form-data"},processData:!1,cache:!1,dataType:"json",data:r,xhr:function(){var n=$("#UploadProgress"),t;return n.css("width","0%"),n.html("0%"),t=$.ajaxSettings.xhr(),t.upload.addEventListener("progress",function(t){if(t.lengthComputable){var i=Math.round(t.loaded/t.total*100);n.css("width",i+"%");n.html(i+"%")}},!1),t},success:function(n,t,i){var u,r;$("#UploadProgressbar").hide();u=i.getResponseHeader("content-type")||"";u.indexOf("json")>=0&&n&&n!=""&&(r=n,oUIStringDic&&(r=oUIStringDic.Constant.UnuploadedFiles+n),alert(r))},error:function(n,t){$("#UploadProgressbar").hide();ShowErrorMessage("Server Error!",t)}};$("#UploadProgressbar").show();$.ajax(u)}function OnIntervalChange(n){if(n&&!bCompositioning){var t=$(n),i=GetTimeInterval(t.val());t.val(i)}}function OnAnimationOnOffSwitchChanged(n){if(n){var i=isChecked($(n)),t=$("#AnimationOnOffSwitch > span");i?(t.html("ON"),t.removeClass("w3-right-align"),t.addClass("w3-left-align")):(t.html("OFF"),t.removeClass("w3-left-align"),t.addClass("w3-right-align"))}}function isChecked(n){return n.prop("checked")}function GetTimeInterval(n){var t=parseInt(n);return t=="NaN"&&(t=4e3),t>2e4&&(t=2e4),t<1e3&&(t=1e3),t}function getGetUIStringsParamJsonData(){var n=getLauguageIndex(),t={LangguageIndex:n};return JSON.stringify(t)}function getGetNextDataParamJsonData(n){var t=getLauguageIndex(),i=$("#FileNameFilter").val(),r=isChecked($("#AnimationOnOffSwitch > input")),u={CallFiFoGUID:n,LangguageIndex:t,Filter:i,Animation:r,CurrentFileName:strCurrentFileName};return JSON.stringify(u)}function getLauguageIndex(){var n=0;return supportLanguages&&nCurrentLanguage>=0&&nCurrentLanguage<supportLanguages.length&&(n=nCurrentLanguage),n}function ResetUIString(){oUIStringDic&&$(".needTranslation").each(function(){var t=oUIStringDic[this.id],n;t&&(n=$(this),$.each(t,function(t,i){t=="html"?n.html(i):n.attr(t,i)}))})}function Init(){var n,t;biOS=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);bMSIE=!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g);biOS&&$("#btnSaveAs").css("display","none");supportLanguages&&supportLanguages.length>1?(n="",navigator.language?(n=navigator.language.toLowerCase(),n=="ja"&&(n="ja-jp")):navigator.browserLanguage&&(n=navigator.browserLanguage.toLowerCase()),t=n.split("-")[0],nCurrentLanguage=jQuery.inArray(t,supportLanguages),nCurrentLanguage<0&&(nCurrentLanguage=0)):nCurrentLanguage=-1}function ShowErrorMessage(n,t){var i=$("#ShowErrorMessage"),r,u;i&&(n==""&&t==""?i.hide():(r=i.children("h3"),r&&r.html(n),u=i.children("p"),u&&u.html(t),i.show()))}function ShowHideOnProcessing(n){n?$("#OnProcessing").show():$("#OnProcessing").hide()}function openNav(){document.getElementById("ControlPanel").style.display="block";document.getElementById("buttonOpenControlPanel").style.display="none"}function closeNav(){document.getElementById("ControlPanel").style.display="none";document.getElementById("buttonOpenControlPanel").style.display="block"}var uri="/api/gifdata",supportLanguages=["en","zh","ja"],nCurrentLanguage=0,oUIStringDic=null,biOS=!1,bMSIE=!1,bCompositioning=!1,resetImageFiFo=[],strCurrentFileName="";$.guid=0;$(document).ready(function(){ShowHideOnProcessing(!0);Init();GetUIStrings();ResetUIString();$("#LetteringText").on("compositionstart",function(){bCompositioning=!0});$("#LetteringText").on("compositionend",function(){bCompositioning=!1});ShowHideOnProcessing(!1);$("#UploadProgressbar").hide();$("#UploadFiles").change(function(n){UploadFiles(n)});ShowNextData()});