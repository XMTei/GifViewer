function GetUIStrings(){ShowOf(ShowErrorMessage,!1);var n=getGetUIStringsParamJsonData(),t={async:!1,crossDomain:!0,url:uri+"/GetUIStrings",method:"POST",headers:{"content-type":"application/json","cache-control":"no-cache"},data:n,success:function(n,t,i){var f=i.getResponseHeader("content-type")||"",u,r;if(f.indexOf("json")>=0)if(n.type&&n.type.indexOf("Json")>=0&&n.data&&n.data.length>0){oUIStringDic=null;try{u=JSON.parse(n.data);u&&(oUIStringDic=u)}catch(e){ShowErrorMessageFunc("Data Error!","Bad UI strings JSON Data:"+e)}}else r="Can not translate UI.",n.type&&(r+=",DataType:"+n.type,n.type.indexOf("Text")>=0&&(r+=",Message:"+n.data)),alert(r)},error:function(n,t){ShowErrorMessageFunc("Server Error!",t)}};$.ajax(t)}function ShowNextData(){var n,t,i;ShowOf(ShowErrorMessage,!1);n=$.guid++;resetImageFiFo.push(n);t=getGetNextDataParamJsonData(n);i={async:!0,crossDomain:!0,url:uri+"/GetNextData",method:"POST",headers:{"content-type":"application/json","cache-control":"no-cache"},data:t,success:function(n,t,i){var f,s,r,e;Imagedata.src="";var o=0,u=0,a=i.getResponseHeader("content-type")||"";a.indexOf("json")>=0&&(f=-1,n.callFiFoGUID>=0&&(f=resetImageFiFo.indexOf(n.callFiFoGUID)),s=!1,n.type&&f>=0&&(resetImageFiFo.splice(0,f+1),resetImageFiFo.length<=0&&ShowOf(OnProcessing,!1),n.type.indexOf("Json")>=0&&(r=JSON.parse(n.data),r&&(r.Type.indexOf("GifBase64")>=0?Imagedata.src="data:image/gif;base64,"+r.Data:r.Type.indexOf("PngBase64")>=0?Imagedata.src="data:image/png;base64,"+r.Data:r.Type.indexOf("TiffBase64")>=0&&(Imagedata.src="data: image/tiff;base64,"+r.Data),strCurrentFileName=r.FileName,o=r.Index,u=r.Total,s=!0))),s||(e="Can not get the GIF file",n.type&&(e+=",DataType:"+n.type,n.type.indexOf("Text")>=0&&(e+=",Message:"+n.data)),ShowErrorMessageFunc("Caution:",e)));var c=$(Progressbar),l=0,h="";u>0?(h="("+strCurrentFileName+") "+o+"/"+u,l=o/u*100):oUIStringDic&&(h=oUIStringDic.Constant.NoGifFileOnServer);c.css("width",l+"%");c.html(h);setTimeout(function(){ShowNextData()},GetTimeInterval($(TimeInterval).val()))},error:function(n,t){ShowErrorMessageFunc("Server Error!",t)}};$.ajax(i)}function UploadFiles(n){var i,r,t,u;for(ShowOf(ShowErrorMessage,!1),i=n.currentTarget.files,r=new FormData,t=0;t<i.length;t++)r.append(i[t].name,i[t]);u={async:!0,crossDomain:!0,url:uri+"/Upload",method:"POST",contentType:!1,processData:!1,cache:!1,dataType:"json",data:r,xhr:function(){var n=$("#UploadProgress"),t;return n.css("width","0%"),n.html("0%"),t=$.ajaxSettings.xhr(),t.upload.addEventListener("progress",function(t){if(t.lengthComputable){var i=Math.round(t.loaded/t.total*100);n.css("width",i+"%");n.html(i+"%")}},!1),t},success:function(n,t,i){var u,r;ShowOf(UploadProgressbar,!1);u=i.getResponseHeader("content-type")||"";u.indexOf("json")>=0&&n&&n!=""&&(r=n,oUIStringDic&&(r=oUIStringDic.Constant.UnuploadedFiles+n),alert(r))},error:function(n,t){ShowOf(UploadProgressbar,!1);ShowErrorMessageFunc("Server Error!",t)}};ShowOf(UploadProgressbar,!0);$.ajax(u)}function OnIntervalChange(n){if(n&&!bCompositioning){var t=$(n),i=GetTimeInterval(t.val());t.val(i)}}function OnAnimationOnOffSwitchChanged(n){if(n){var i=isChecked($(n)),t=$("#AnimationOnOffSwitch > span");i?(t.html("ON"),t.removeClass("w3-right-align"),t.addClass("w3-left-align")):(t.html("OFF"),t.removeClass("w3-left-align"),t.addClass("w3-right-align"))}}function isChecked(n){return n.prop("checked")}function GetTimeInterval(n){var t=parseInt(n);return t=="NaN"&&(t=4e3),t>2e4&&(t=2e4),t<1e3&&(t=1e3),t}function getGetUIStringsParamJsonData(){var n=getLauguageIndex(),t={LangguageIndex:n};return JSON.stringify(t)}function getGetNextDataParamJsonData(n){var t=getLauguageIndex(),i=$("#FileNameFilter").val(),r=isChecked($("#AnimationOnOffSwitch > input")),u={CallFiFoGUID:n,LangguageIndex:t,Filter:i,Animation:r,CurrentFileName:strCurrentFileName};return JSON.stringify(u)}function getLauguageIndex(){var n=0;return supportLanguages&&nCurrentLanguage>=0&&nCurrentLanguage<supportLanguages.length&&(n=nCurrentLanguage),n}function ResetUIString(){oUIStringDic&&$(".needTranslation").each(function(){var t=oUIStringDic[this.id],n;t&&(n=$(this),$.each(t,function(t,i){t=="html"?n.html(i):n.attr(t,i)}))})}function Init(){var n,t;biOS=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);bMSIE=!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g);supportLanguages&&supportLanguages.length>1?(n="",navigator.language?(n=navigator.language.toLowerCase(),n=="ja"&&(n="ja-jp")):navigator.browserLanguage&&(n=navigator.browserLanguage.toLowerCase()),t=n.split("-")[0],nCurrentLanguage=jQuery.inArray(t,supportLanguages),nCurrentLanguage<0&&(nCurrentLanguage=0)):nCurrentLanguage=-1}function ShowErrorMessageFunc(n,t){var i=$("#ShowErrorMessage"),r,u;i&&(n==""&&t==""?ShowOf(ShowErrorMessage,!1):(r=i.children("h3"),r&&r.html(n),u=i.children("p"),u&&u.html(t),ShowOf(ShowErrorMessage,!0)))}function ShowOf(n,t){n&&(n.style.display=t?"block":"none")}function openNav(){ShowOf(ControlPanel,!0);ShowOf(buttonOpenControlPanel,!1)}function closeNav(){ShowOf(ControlPanel,!1);ShowOf(buttonOpenControlPanel,!1)}var uri="/api/gifdata",supportLanguages=["en","zh","ja"],nCurrentLanguage=0,oUIStringDic=null,biOS=!1,bMSIE=!1,bCompositioning=!1,resetImageFiFo=[],strCurrentFileName="";$.guid=0;$(document).ready(function(){ShowOf(OnProcessing,!0);Init();GetUIStrings();ResetUIString();$("#LetteringText").on("compositionstart",function(){bCompositioning=!0});$("#LetteringText").on("compositionend",function(){bCompositioning=!1});ShowOf(OnProcessing,!1);ShowOf(UploadProgressbar,!1);$("#UploadFiles").change(function(n){UploadFiles(n)});ShowNextData()});